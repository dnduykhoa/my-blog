{{ define "head" }}
<meta name="description" content="{{ .Params.description }}">
<link rel="stylesheet" href="{{.Site.Params.staticPath}}/css/single.css">
<script defer src="{{.Site.Params.staticPath}}/fontawesome-6/all-6.4.2.js"></script>
{{ end }}

{{ define "title" }}
{{ .Title }} | {{ .Site.Title }}
{{ end }}

{{ define "main" }}
<section id="single">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-sm-12 col-md-12 col-lg-9">
        <div class="pr-lg-4">
          <div class="title mb-5">
            <h1 class="text-center mb-4">{{ .Title }}</h1>
            <div class="text-center">
              {{ if .Params.author }}{{ .Params.author }} <small>|</small>{{ end }}
              {{ .Date.Format (.Site.Params.dateFormat | default "02/01/2006") }}
            </div>
          </div>

          {{ if .Params.image }}
          <div class="featured-image">
            <img class="img-fluid mx-auto d-block" src="{{ .Params.image }}" alt="{{ .Title }}">
          </div>
          {{ end }}

          <article class="page-content p-2">
            {{ .Content | emojify }}
          </article>
        </div>
      </div>

      <div class="col-sm-12 col-md-12 col-lg-3">
        <div id="stickySideBar" class="sticky-sidebar">
          {{ if .Params.toc | default true }}
          <aside class="toc">
            <h5>{{ .Site.Params.terms.toc | default "Mục lục" }}</h5>
            <div class="toc-content">
              {{ $toc := .TableOfContents | safeHTML }}
              {{ $toc = replaceRE "<img[\\s\\S]*?>" "" $toc }}
              {{ $toc = replaceRE "<figure[\\s\\S]*?</figure>" "" $toc }}
              {{ $toc = replaceRE "<picture[\\s\\S]*?</picture>" "" $toc }}
              {{ $toc | safeHTML }}
            </div>
          </aside>
          {{ end }}

          {{ if .Params.tags }}
          <aside class="tags">
            <h5>{{ .Site.Params.terms.tags | default "Tags" }}</h5>
            <ul class="tags-ul list-unstyled list-inline">
              {{ range .Params.tags }}
              <li class="list-inline-item">
                <a href="{{ `tags` | absURL }}/{{ . | urlize }}" {{ if site.Params.singlePages.tags.openInNewTab | default true }}target="_blank"{{ end }}>{{ . }}</a>
              </li>
              {{ end }}
            </ul>
          </aside>
          {{ end }}

          {{ if .Params.socialShare | default .Site.Params.singlePages.socialShare | default true }}
          <aside class="social">
            <h5>{{ .Site.Params.terms.social | default "Chia sẻ" }}</h5>
            <div class="social-content">
              <ul class="list-inline">
                <li class="list-inline-item text-center">
                  <a target="_blank" href="https://www.linkedin.com/shareArticle?mini=true&url={{ .Permalink | absURL }}"><i class="fab fa-linkedin"></i></a>
                </li>
                <li class="list-inline-item text-center">
                  <a target="_blank" href="https://twitter.com/share?text={{ .Title }}&url={{ .Permalink | absURL }}"><i class="fab fa-twitter"></i></a>
                </li>
                <li class="list-inline-item text-center">
                  <a target="_blank" href="https://api.whatsapp.com/send?text={{ .Title }}: {{ .Permalink | absURL }}"><i class="fab fa-whatsapp"></i></a>
                </li>
                <li class="list-inline-item text-center">
                  <a target="_blank" href='mailto:?subject={{ .Title }}&amp;body={{ .Site.Params.terms.emailText | default "Check out this site" }} {{ .Permalink | absURL }}'><i class="fa fa-envelope"></i></a>
                </li>
              </ul>
            </div>
          </aside>
          {{ end }}
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-sm-12 col-md-12 col-lg-9 p-4">
        {{ template "_internal/disqus.html" . }}
      </div>
    </div>
  </div>
</section>

<div class="progress">
  <div id="scroll-progress-bar" class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
</div>
<script src="{{.Site.Params.staticPath}}/js/scrollProgressBar.js"></script>

<script>
  // sticky sidebar offset (đơn giản, tránh lỗi JS)
  let stickySideBarElem = document.getElementById("stickySideBar");
  let stickyNavBar = false; // đặt false để không gây lỗi
  if(stickyNavBar){
    let headerElem = document.getElementById("profileHeader");
    let headerHeight = (headerElem?.offsetHeight || 35) + 15;
    stickySideBarElem.style.top = headerHeight + "px";
  } else {
    stickySideBarElem.style.top = "50px";
  }
</script>

{{ end }}